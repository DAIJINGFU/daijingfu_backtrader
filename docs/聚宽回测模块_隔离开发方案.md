# èšå®½å›æµ‹æ¨¡å— - éš”ç¦»å¼€å‘æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†å°†èšå®½å›æµ‹æ¨¡å—ï¼ˆJoinQuant Backtest Moduleï¼‰æŠ½ç¦»ä¸ºç‹¬ç«‹å¼€å‘åŒ…çš„å®Œæ•´æ–¹æ¡ˆï¼Œå…è®¸å¤–éƒ¨å®ä¹ ç”ŸåŸºäºç»Ÿä¸€æ¥å£å’Œæ•°æ®ç¯å¢ƒè¿›è¡Œç‹¬ç«‹å¼€å‘ï¼Œæœ€åå¯æ— ç¼é›†æˆå›ä¸»ç³»ç»Ÿã€‚

---

## ğŸ¯ ç›®æ ‡

1. **éš”ç¦»æ€§**: å®ä¹ ç”Ÿæ— æ³•æ¥è§¦ä¸»ç³»ç»Ÿçš„å…¶ä»–æ ¸å¿ƒä»£ç 
2. **æ¥å£ç»Ÿä¸€**: éµå¾ªç›¸åŒçš„APIè§„èŒƒå’Œæ•°æ®æ¥å£
3. **ç‹¬ç«‹å¼€å‘**: å¯ç‹¬ç«‹è¿è¡Œã€æµ‹è¯•ã€è°ƒè¯•
4. **æ— ç¼é›†æˆ**: å¼€å‘å®Œæˆåå¯ç›´æ¥æ›¿æ¢ç°æœ‰æ¨¡å—
5. **ç¯å¢ƒä¸€è‡´**: ä½¿ç”¨ç›¸åŒçš„ä¾èµ–å’Œæ•°æ®æ ¼å¼

---

## ğŸ“¦ éš”ç¦»åŒ…ç»“æ„

### å»ºè®®é¡¹ç›®ç»“æ„

```
jq-backtest-standalone/
â”œâ”€â”€ README.md                    # å¼€å‘æŒ‡å—
â”œâ”€â”€ pyproject.toml              # ç‹¬ç«‹ä¾èµ–é…ç½®
â”œâ”€â”€ requirements.txt            # ä¾èµ–æ¸…å•
â”œâ”€â”€ .env.example               # ç¯å¢ƒé…ç½®ç¤ºä¾‹
â”œâ”€â”€ docker-compose.yml         # æœ¬åœ°å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ API_SPECIFICATION.md   # APIè§„èŒƒæ–‡æ¡£
â”‚   â”œâ”€â”€ INTEGRATION_GUIDE.md   # é›†æˆæŒ‡å—
â”‚   â””â”€â”€ EXAMPLES.md           # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_engine.py        # å¼•æ“æµ‹è¯•
â”‚   â”œâ”€â”€ test_strategy.py      # ç­–ç•¥æµ‹è¯•
â”‚   â”œâ”€â”€ test_data_api.py      # æ•°æ®APIæµ‹è¯•
â”‚   â”œâ”€â”€ test_trading_api.py   # äº¤æ˜“APIæµ‹è¯•
â”‚   â””â”€â”€ fixtures/             # æµ‹è¯•æ•°æ®
â”‚       â”œâ”€â”€ sample_data/      # CSVæ ·æœ¬æ•°æ®
â”‚       â””â”€â”€ sample_strategies/ # ç¤ºä¾‹ç­–ç•¥
â”œâ”€â”€ jq_backtest/              # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ engine.py             # å›æµ‹å¼•æ“ï¼ˆéœ€å®ç°ï¼‰
â”‚   â”œâ”€â”€ strategy.py           # ç­–ç•¥é€‚é…å™¨ï¼ˆéœ€å®ç°ï¼‰
â”‚   â”œâ”€â”€ context.py            # ä¸Šä¸‹æ–‡å¯¹è±¡
â”‚   â”œâ”€â”€ portfolio.py          # æŠ•èµ„ç»„åˆ
â”‚   â”œâ”€â”€ order.py              # è®¢å•æ¨¡å‹
â”‚   â”œâ”€â”€ trading_api.py        # äº¤æ˜“API
â”‚   â”œâ”€â”€ data_api.py           # æ•°æ®API
â”‚   â”œâ”€â”€ csv_adapter.py        # CSVæ•°æ®é€‚é…å™¨ï¼ˆéœ€å®ç°ï¼‰
â”‚   â”œâ”€â”€ trading_rules.py      # äº¤æ˜“è§„åˆ™
â”‚   â””â”€â”€ utils.py              # å·¥å…·å‡½æ•°
â”œâ”€â”€ interfaces/               # æ¥å£å®šä¹‰ï¼ˆåªè¯»ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_provider.py      # æ•°æ®æä¾›è€…æ¥å£
â”‚   â””â”€â”€ backtest_service.py   # å›æµ‹æœåŠ¡æ¥å£
â”œâ”€â”€ examples/                 # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ basic_strategy.py     # åŸºç¡€ç­–ç•¥ç¤ºä¾‹
â”‚   â”œâ”€â”€ ma_crossover.py       # å‡çº¿ç­–ç•¥
â”‚   â””â”€â”€ run_backtest.py       # è¿è¡Œå›æµ‹ç¤ºä¾‹
â””â”€â”€ scripts/
    â”œâ”€â”€ setup_env.sh          # ç¯å¢ƒæ­å»ºè„šæœ¬
    â”œâ”€â”€ run_tests.sh          # æµ‹è¯•è„šæœ¬
    â””â”€â”€ validate_integration.sh # é›†æˆéªŒè¯è„šæœ¬
```

---

## ğŸ”Œ æ¥å£å®šä¹‰

### 1. æ•°æ®æä¾›è€…æ¥å£ (`interfaces/data_provider.py`)

è¿™æ˜¯å®ä¹ ç”Ÿéœ€è¦éµå¾ªçš„æ ¸å¿ƒæ•°æ®æ¥å£ï¼Œä¸ä¸»ç³»ç»Ÿå®Œå…¨å…¼å®¹ï¼š

```python
"""
æ•°æ®æä¾›è€…æ¥å£å®šä¹‰
å®ä¹ ç”Ÿéœ€è¦é€šè¿‡è¿™ä¸ªæ¥å£è·å–æ•°æ®ï¼Œç¡®ä¿ä¸ä¸»ç³»ç»Ÿå…¼å®¹
"""
from abc import ABC, abstractmethod
from datetime import datetime
from typing import List, Optional
import pandas as pd


class IDataProvider(ABC):
    """æ•°æ®æä¾›è€…æ¥å£ - ä¸ä¸»ç³»ç»Ÿ CSVDataProvider å…¼å®¹"""
    
    @abstractmethod
    def load_data(
        self,
        security: str,
        start_date: datetime,
        end_date: datetime,
        freq: str = 'daily',
        adjust: str = 'pre'
    ) -> pd.DataFrame:
        """
        åŠ è½½å•ä¸ªè¯åˆ¸çš„å†å²æ•°æ®
        
        Args:
            security: è¯åˆ¸ä»£ç  (å¦‚ '000001.XSHE')
            start_date: å¼€å§‹æ—¥æœŸ
            end_date: ç»“æŸæ—¥æœŸ
            freq: é¢‘ç‡ ('daily' or 'minute')
            adjust: å¤æƒæ–¹å¼ ('pre', 'post', 'none')
            
        Returns:
            DataFrame with columns: datetime, open, high, low, close, volume
        """
        pass
    
    @abstractmethod
    def load_multiple(
        self,
        securities: List[str],
        start_date: datetime,
        end_date: datetime,
        freq: str = 'daily',
        adjust: str = 'pre'
    ) -> dict[str, pd.DataFrame]:
        """
        æ‰¹é‡åŠ è½½å¤šä¸ªè¯åˆ¸çš„å†å²æ•°æ®
        
        Returns:
            å­—å…¸: {security_code: DataFrame}
        """
        pass
    
    @abstractmethod
    def get_history_data(
        self,
        securities: List[str],
        count: int,
        end_date: datetime,
        freq: str = 'daily',
        fields: List[str] = None,
        fq: str = 'pre'
    ) -> pd.DataFrame:
        """
        è·å–å†å²æ•°æ®ï¼ˆèšå®½APIå…¼å®¹ï¼‰
        
        Args:
            securities: è¯åˆ¸åˆ—è¡¨
            count: æ•°æ®æ¡æ•°
            end_date: ç»“æŸæ—¥æœŸ
            freq: é¢‘ç‡
            fields: å­—æ®µåˆ—è¡¨ ['open', 'close', 'high', 'low', 'volume']
            fq: å¤æƒæ–¹å¼
            
        Returns:
            å¤šç´¢å¼•DataFrame (datetime, security)
        """
        pass
```

### 2. å›æµ‹æœåŠ¡æ¥å£ (`interfaces/backtest_service.py`)

```python
"""
å›æµ‹æœåŠ¡æ¥å£å®šä¹‰
è¿™æ˜¯å®ä¹ ç”Ÿéœ€è¦å®ç°çš„æ ¸å¿ƒæ¥å£
"""
from abc import ABC, abstractmethod
from datetime import datetime
from typing import Dict, List, Optional, Any


class IBacktestService(ABC):
    """å›æµ‹æœåŠ¡æ¥å£ - éœ€è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½"""
    
    @abstractmethod
    def run_backtest(
        self,
        strategy_code: str,
        start_date: datetime,
        end_date: datetime,
        initial_cash: float = 1000000,
        securities: Optional[List[str]] = None,
        commission: Optional[float] = None,
        stamp_duty: Optional[float] = None,
        freq: str = 'daily',
        fq: str = 'pre'
    ) -> Dict[str, Any]:
        """
        è¿è¡Œå›æµ‹
        
        Args:
            strategy_code: ç­–ç•¥ä»£ç ï¼ˆåŒ…å«initializeå’Œhandle_dataå‡½æ•°ï¼‰
            start_date: å¼€å§‹æ—¥æœŸ
            end_date: ç»“æŸæ—¥æœŸ
            initial_cash: åˆå§‹èµ„é‡‘
            securities: è¯åˆ¸åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰
            commission: æ‰‹ç»­è´¹ç‡ï¼ˆå¯é€‰ï¼‰
            stamp_duty: å°èŠ±ç¨ç‡ï¼ˆå¯é€‰ï¼‰
            freq: æ•°æ®é¢‘ç‡
            fq: å¤æƒæ–¹å¼
            
        Returns:
            å›æµ‹ç»“æœå­—å…¸ï¼ŒåŒ…å«:
            {
                'backtest_id': str,
                'status': str,
                'initial_cash': float,
                'final_value': float,
                'total_return': float,
                'sharpe_ratio': float,
                'max_drawdown': float,
                'equity_curve': List[dict],
                'trades': List[dict],
                'positions': List[dict],
                ...
            }
        """
        pass
    
    @abstractmethod
    def validate_strategy_code(self, strategy_code: str) -> Dict[str, Any]:
        """
        éªŒè¯ç­–ç•¥ä»£ç çš„æœ‰æ•ˆæ€§
        
        Returns:
            {
                'valid': bool,
                'errors': List[str],
                'warnings': List[str]
            }
        """
        pass
```

---

## ğŸ“š æä¾›ç»™å®ä¹ ç”Ÿçš„æ–‡ä»¶

### éœ€è¦æä¾›çš„å®Œæ•´æ–‡ä»¶æ¸…å•

#### 1. æ¥å£å®šä¹‰ï¼ˆåªè¯»ï¼‰
```
interfaces/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ data_provider.py      # âœ… æ•°æ®æ¥å£å®šä¹‰
â””â”€â”€ backtest_service.py   # âœ… æœåŠ¡æ¥å£å®šä¹‰
```

#### 2. ç°æœ‰å®ç°ï¼ˆå‚è€ƒï¼Œä¸ä¿®æ”¹ï¼‰
```
jq_backtest/
â”œâ”€â”€ context.py            # âœ… Context, g, RunParams
â”œâ”€â”€ portfolio.py          # âœ… Portfolio, Position
â”œâ”€â”€ order.py              # âœ… Order, OrderStyle, MarketOrderç­‰
â”œâ”€â”€ trading_api.py        # âœ… TradingAPIå®ç°
â”œâ”€â”€ data_api.py          # âœ… DataAPIå®ç°
â”œâ”€â”€ trading_rules.py      # âœ… Aè‚¡äº¤æ˜“è§„åˆ™
â””â”€â”€ utils.py              # âœ… å·¥å…·å‡½æ•°
```

#### 3. éœ€è¦å®ç°çš„æ ¸å¿ƒæ–‡ä»¶
```
jq_backtest/
â”œâ”€â”€ engine.py             # âš ï¸ éœ€è¦å®ç°ï¼šä¸»å¼•æ“
â”œâ”€â”€ strategy.py           # âš ï¸ éœ€è¦å®ç°ï¼šç­–ç•¥é€‚é…å™¨
â””â”€â”€ csv_adapter.py        # âš ï¸ éœ€è¦å®ç°ï¼šæ•°æ®é€‚é…å™¨
```

#### 4. æµ‹è¯•æ•°æ®
```
tests/fixtures/
â”œâ”€â”€ sample_data/
â”‚   â”œâ”€â”€ 000001.XSHE_daily.csv      # æ ·æœ¬æ—¥çº¿æ•°æ®
â”‚   â”œâ”€â”€ 000001.XSHE_minute.csv     # æ ·æœ¬åˆ†é’Ÿæ•°æ®
â”‚   â””â”€â”€ 000300.XSHG_daily.csv      # åŸºå‡†æ•°æ®
â””â”€â”€ sample_strategies/
    â”œâ”€â”€ simple_ma.py                # ç®€å•å‡çº¿ç­–ç•¥
    â””â”€â”€ buy_and_hold.py            # ä¹°å…¥æŒæœ‰ç­–ç•¥
```

---

## ğŸ›  å®ä¹ ç”Ÿå¼€å‘ä»»åŠ¡

### Phase 1: ç¯å¢ƒæ­å»º (1å¤©)

1. **å…‹éš†éš”ç¦»ä»“åº“**
   ```bash
   git clone <isolated-repo-url>
   cd jq-backtest-standalone
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   pip install -e .
   ```

3. **é…ç½®ç¯å¢ƒ**
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env è®¾ç½®æ•°æ®è·¯å¾„
   ```

4. **è¿è¡Œç¤ºä¾‹æµ‹è¯•**
   ```bash
   pytest tests/ -v
   ```

### Phase 2: æ ¸å¿ƒå®ç° (5-7å¤©)

#### ä»»åŠ¡1: å®ç°CSVæ•°æ®é€‚é…å™¨ (`csv_adapter.py`)

**ç›®æ ‡**: å°†CSVæ–‡ä»¶è½¬æ¢ä¸ºbacktraderå¯ç”¨çš„æ•°æ®æ ¼å¼

**å…³é”®ç‚¹**:
- è¯»å–CSVæ–‡ä»¶
- å¤„ç†å¤æƒæ•°æ®
- æ”¯æŒæ—¥çº¿å’Œåˆ†é’Ÿçº¿
- ç¼“å­˜æœºåˆ¶

**éªŒæ”¶æ ‡å‡†**:
```python
# æµ‹è¯•ä»£ç 
adapter = CSVDataFeedAdapter(data_provider)
data = adapter.load_data('000001.XSHE', start, end)
assert 'close' in data.columns
assert len(data) > 0
```

#### ä»»åŠ¡2: å®ç°ç­–ç•¥é€‚é…å™¨ (`strategy.py`)

**ç›®æ ‡**: å°†JoinQuantç­–ç•¥ä»£ç é€‚é…åˆ°backtraderæ¡†æ¶

**å…³é”®ç‚¹**:
- è§£æç”¨æˆ·ç­–ç•¥ä»£ç ï¼ˆinitialize, handle_dataï¼‰
- å®ç°APIæ³¨å…¥æœºåˆ¶
- ç®¡ç†è®¢å•ç”Ÿå‘½å‘¨æœŸ
- è·Ÿè¸ªæŒä»“å’Œèµ„é‡‘

**éªŒæ”¶æ ‡å‡†**:
```python
# ç­–ç•¥ç¤ºä¾‹åº”è¯¥èƒ½æ­£å¸¸è¿è¡Œ
strategy_code = """
def initialize(context):
    g.security = '000001.XSHE'

def handle_data(context, data):
    price = data[g.security].close
    if price > 10:
        order(g.security, 100)
"""
# åº”è¯¥èƒ½æˆåŠŸæ‰§è¡Œ
```

#### ä»»åŠ¡3: å®ç°å›æµ‹å¼•æ“ (`engine.py`)

**ç›®æ ‡**: ç»„ç»‡æ•´ä¸ªå›æµ‹æµç¨‹

**å…³é”®ç‚¹**:
- åˆå§‹åŒ–backtrader
- åŠ è½½æ•°æ®feeds
- è¿è¡Œç­–ç•¥
- è®¡ç®—å›æµ‹æŒ‡æ ‡
- ç”Ÿæˆç»“æœæŠ¥å‘Š

**éªŒæ”¶æ ‡å‡†**:
- èƒ½è¿è¡Œå®Œæ•´å›æµ‹
- è¾“å‡ºç¬¦åˆæ¥å£è§„èŒƒçš„ç»“æœ
- åŒ…å«æ‰€æœ‰å¿…éœ€æŒ‡æ ‡

### Phase 3: æµ‹è¯•ä¸ä¼˜åŒ– (2-3å¤©)

1. **å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%**
2. **é›†æˆæµ‹è¯•é€šè¿‡**
3. **æ€§èƒ½åŸºå‡†æµ‹è¯•**
4. **æ–‡æ¡£å®Œå–„**

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

#### 1. APIå…¼å®¹æ€§æµ‹è¯•
```python
# æµ‹è¯•èšå®½APIå…¼å®¹æ€§
def test_joinquant_api_compatibility():
    """ç¡®ä¿æ‰€æœ‰JoinQuant APIéƒ½èƒ½æ­£å¸¸å·¥ä½œ"""
    strategy = """
    def initialize(context):
        set_benchmark('000300.XSHG')
        set_order_cost(OrderCost(open_tax=0, close_tax=0.001))
        
    def handle_data(context, data):
        # æµ‹è¯•æ‰€æœ‰äº¤æ˜“API
        order('000001.XSHE', 100)
        order_target('000001.XSHE', 200)
        order_value('000001.XSHE', 10000)
        order_target_value('000001.XSHE', 50000)
        
        # æµ‹è¯•æ•°æ®API
        hist = history(5, '1d', 'close', ['000001.XSHE'])
        price = get_price('000001.XSHE')
    """
    
    result = service.run_backtest(
        strategy_code=strategy,
        start_date=datetime(2023, 1, 1),
        end_date=datetime(2023, 12, 31)
    )
    
    assert result['status'] == 'completed'
    assert 'final_value' in result
    assert 'sharpe_ratio' in result
```

#### 2. ç»“æœæ ¼å¼éªŒè¯
```python
def test_result_format():
    """éªŒè¯è¿”å›ç»“æœæ ¼å¼"""
    result = run_backtest(...)
    
    # å¿…éœ€å­—æ®µ
    required_fields = [
        'backtest_id', 'status', 'initial_cash', 'final_value',
        'total_return', 'sharpe_ratio', 'max_drawdown',
        'equity_curve', 'trades', 'positions'
    ]
    
    for field in required_fields:
        assert field in result
    
    # æ•°æ®ç±»å‹æ£€æŸ¥
    assert isinstance(result['equity_curve'], list)
    assert isinstance(result['trades'], list)
    assert isinstance(result['total_return'], float)
```

#### 3. æ€§èƒ½åŸºå‡†æµ‹è¯•
```python
def test_performance_benchmark():
    """æ€§èƒ½æµ‹è¯•"""
    import time
    
    start = time.time()
    result = run_backtest(
        strategy_code=sample_strategy,
        start_date=datetime(2020, 1, 1),
        end_date=datetime(2023, 12, 31),
        securities=['000001.XSHE']
    )
    elapsed = time.time() - start
    
    # 3å¹´æ—¥çº¿æ•°æ®å›æµ‹åº”åœ¨30ç§’å†…å®Œæˆ
    assert elapsed < 30
    assert result['status'] == 'completed'
```

### é›†æˆéªŒæ”¶

#### å‡†å¤‡é›†æˆåŒ…
```bash
# æ‰“åŒ…æ¨¡å—
python scripts/prepare_integration.py

# ç”Ÿæˆçš„é›†æˆåŒ…åº”åŒ…å«ï¼š
integration_package/
â”œâ”€â”€ jq_backtest/          # æ‰€æœ‰æºä»£ç 
â”œâ”€â”€ tests/                # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ INTEGRATION_REPORT.md # é›†æˆæŠ¥å‘Š
â””â”€â”€ CHANGELOG.md          # å˜æ›´æ—¥å¿—
```

#### é›†æˆæµ‹è¯•
```bash
# åœ¨ä¸»ç³»ç»Ÿä¸­è¿è¡Œé›†æˆæµ‹è¯•
cd /path/to/main-system
cp -r integration_package/jq_backtest backend/services/
pytest tests/integration/test_jq_backtest_integration.py
```

---

## ğŸ“ å¼€å‘æ–‡æ¡£æ¸…å•

### éœ€è¦æä¾›ç»™å®ä¹ ç”Ÿçš„æ–‡æ¡£

1. **README.md** - å¿«é€Ÿå¼€å§‹æŒ‡å—
2. **API_SPECIFICATION.md** - è¯¦ç»†APIè§„èŒƒ
3. **EXAMPLES.md** - ä»£ç ç¤ºä¾‹é›†
4. **INTEGRATION_GUIDE.md** - é›†æˆæŒ‡å—
5. **JOINQUANT_API_REFERENCE.md** - JoinQuant APIå‚è€ƒ

### å®ä¹ ç”Ÿéœ€è¦æäº¤çš„æ–‡æ¡£

1. **DEVELOPMENT_LOG.md** - å¼€å‘æ—¥å¿—
2. **TECHNICAL_DECISIONS.md** - æŠ€æœ¯å†³ç­–æ–‡æ¡£
3. **TESTING_REPORT.md** - æµ‹è¯•æŠ¥å‘Š
4. **INTEGRATION_REPORT.md** - é›†æˆå‡†å¤‡æŠ¥å‘Š

---

## ğŸ”’ å®‰å…¨ä¸éš”ç¦»æªæ–½

### ä»£ç éš”ç¦»
1. âœ… ç‹¬ç«‹Gitä»“åº“
2. âœ… ä¸åŒ…å«ä¸»ç³»ç»Ÿä»»ä½•ä¸šåŠ¡é€»è¾‘
3. âœ… åªæä¾›æ¥å£å®šä¹‰å’Œç¤ºä¾‹

### æ•°æ®éš”ç¦»
1. âœ… ä½¿ç”¨è„±æ•çš„æ ·æœ¬æ•°æ®
2. âœ… ä¸åŒ…å«çœŸå®ç”¨æˆ·æ•°æ®
3. âœ… æ•°æ®é‡é™åˆ¶ï¼ˆæœ€å¤š1å¹´æ—¥çº¿æ•°æ®ï¼‰

### è®¿é—®æ§åˆ¶
1. âœ… åªè¯»è®¿é—®æ¥å£å®šä¹‰
2. âœ… æ— æ³•è®¿é—®ä¸»ç³»ç»Ÿæ•°æ®åº“
3. âœ… æ— æ³•è®¿é—®ä¸»ç³»ç»ŸAPI

---

## ğŸ”„ é›†æˆæµç¨‹

### Step 1: ä»£ç å®¡æŸ¥
```bash
# å®¡æŸ¥å®ä¹ ç”Ÿæäº¤çš„ä»£ç 
git checkout intern-dev-branch
./scripts/code_review.sh
```

### Step 2: æœ¬åœ°é›†æˆæµ‹è¯•
```bash
# åœ¨éš”ç¦»ç¯å¢ƒæµ‹è¯•
./scripts/validate_integration.sh
```

### Step 3: æ›¿æ¢ç°æœ‰æ¨¡å—
```bash
# å¤‡ä»½ç°æœ‰æ¨¡å—
mv backend/services/jq_backtest backend/services/jq_backtest.backup

# å¤åˆ¶æ–°æ¨¡å—
cp -r intern-delivery/jq_backtest backend/services/

# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
pytest tests/integration/ -v
```

### Step 4: æ€§èƒ½å¯¹æ¯”
```python
# å¯¹æ¯”æ–°æ—§ç‰ˆæœ¬æ€§èƒ½
python scripts/benchmark_comparison.py \
  --old backend/services/jq_backtest.backup \
  --new backend/services/jq_backtest
```

### Step 5: ç°åº¦å‘å¸ƒ
1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œ1å‘¨
2. ç›‘æ§æ€§èƒ½æŒ‡æ ‡
3. é€æ­¥è¿ç§»ç”Ÿäº§æµé‡

---

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### å¼€å‘é˜¶æ®µ
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ‰€æœ‰APIå…¼å®¹æ€§æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½åŸºå‡†è¾¾æ ‡
- [ ] æ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡

### é›†æˆé˜¶æ®µ
- [ ] é›†æˆæµ‹è¯•100%é€šè¿‡
- [ ] æ— æ€§èƒ½é€€åŒ–
- [ ] ç»“æœå‡†ç¡®æ€§éªŒè¯ï¼ˆä¸æ—§ç‰ˆå¯¹æ¯”è¯¯å·®<0.1%ï¼‰
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥é€šè¿‡

---

## ğŸ“ æ”¯æŒä¸æ²Ÿé€š

### æ—¥å¸¸æ²Ÿé€š
- **å‘¨æŠ¥**: æ¯å‘¨äº”æäº¤è¿›å±•æŠ¥å‘Š
- **Daily Standup**: æ¯å¤©åŒæ­¥è¿›åº¦å’Œé—®é¢˜
- **æŠ€æœ¯è®¨è®º**: é€šè¿‡Issueæˆ–æ–‡æ¡£æé—®

### æŠ€æœ¯æ”¯æŒ
- **æ¥å£ç–‘é—®**: æŸ¥çœ‹API_SPECIFICATION.mdæˆ–æIssue
- **æ•°æ®é—®é¢˜**: æ£€æŸ¥æµ‹è¯•æ•°æ®æ ¼å¼æ–‡æ¡£
- **é›†æˆé—®é¢˜**: å‚è€ƒINTEGRATION_GUIDE.md

---

## ğŸ¯ é‡Œç¨‹ç¢‘è®¡åˆ’

| å‘¨æ¬¡ | é‡Œç¨‹ç¢‘ | äº¤ä»˜ç‰© |
|------|--------|--------|
| Week 1 | ç¯å¢ƒæ­å»º + éœ€æ±‚ç†è§£ | ç¯å¢ƒæ­å»ºå®ŒæˆæŠ¥å‘Š |
| Week 2 | CSVé€‚é…å™¨å®ç° | csv_adapter.py + å•å…ƒæµ‹è¯• |
| Week 3 | ç­–ç•¥é€‚é…å™¨å®ç° | strategy.py + å•å…ƒæµ‹è¯• |
| Week 4 | å›æµ‹å¼•æ“å®ç° | engine.py + é›†æˆæµ‹è¯• |
| Week 5 | æµ‹è¯•ä¸ä¼˜åŒ– | å®Œæ•´æµ‹è¯•æŠ¥å‘Š |
| Week 6 | æ–‡æ¡£ä¸é›†æˆå‡†å¤‡ | é›†æˆåŒ… + æ–‡æ¡£ |

---

## ğŸ“‹ äº¤ä»˜æ¸…å•

### æœ€ç»ˆäº¤ä»˜ç‰©
- [x] å®Œæ•´æºä»£ç ï¼ˆjq_backtest/ï¼‰
- [x] å•å…ƒæµ‹è¯•ï¼ˆtests/ï¼‰
- [x] é›†æˆæµ‹è¯•ç”¨ä¾‹
- [x] å¼€å‘æ–‡æ¡£
- [x] APIæ–‡æ¡£
- [x] é›†æˆæŒ‡å—
- [x] æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- [x] ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

### é›†æˆåéªŒè¯
- [ ] ä¸»ç³»ç»Ÿæ‰€æœ‰ä¾èµ–è¯¥æ¨¡å—çš„åŠŸèƒ½æ­£å¸¸
- [ ] æ€§èƒ½æ— é€€åŒ–
- [ ] å›æµ‹ç»“æœå‡†ç¡®æ€§éªŒè¯é€šè¿‡
- [ ] ç›‘æ§æŒ‡æ ‡æ­£å¸¸

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ
1. [ ] åˆ›å»ºéš”ç¦»Gitä»“åº“
2. [ ] å‡†å¤‡åˆå§‹ä»£ç åŒ…
3. [ ] ç”Ÿæˆæ ·æœ¬æµ‹è¯•æ•°æ®
4. [ ] ç¼–å†™è¯¦ç»†çš„APIæ–‡æ¡£
5. [ ] è®¾ç½®CI/CDæµæ°´çº¿

### å‡†å¤‡ææ–™
1. [ ] å®ä¹ ç”ŸåŸ¹è®­PPT
2. [ ] ä»£ç å®¡æŸ¥Checklist
3. [ ] é›†æˆæµ‹è¯•æ–¹æ¡ˆ
4. [ ] ç›‘æ§Dashboardé…ç½®

---

## é™„å½•

### A. ä¾èµ–æ¸…å• (pyproject.toml)

```toml
[project]
name = "jq-backtest-standalone"
version = "1.0.0"
description = "JoinQuant-compatible backtest engine (standalone)"
requires-python = ">=3.10"

dependencies = [
    "pandas>=2.1",
    "numpy>=1.25",
    "backtrader>=1.9.78.123",
    "loguru>=0.7",
    "pytz>=2023.3",
    "pytest>=7.4",
    "pytest-cov>=4.1",
]
```

### B. ç¯å¢ƒé…ç½® (.env.example)

```bash
# æ•°æ®è·¯å¾„é…ç½®
DATA_ROOT=/path/to/sample/data
CACHE_DIR=/path/to/cache

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=/path/to/logs/backtest.log

# æ€§èƒ½é…ç½®
MAX_WORKERS=4
CACHE_ENABLED=true
```

### C. Dockerå¼€å‘ç¯å¢ƒ

```dockerfile
# Dockerfile
FROM python:3.10-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

CMD ["python", "-m", "pytest", "tests/"]
```

```yaml
# docker-compose.yml
version: '3.8'

services:
  jq-backtest:
    build: .
    volumes:
      - ./jq_backtest:/app/jq_backtest
      - ./tests:/app/tests
      - ./data:/app/data
    environment:
      - DATA_ROOT=/app/data
      - LOG_LEVEL=DEBUG
```

---

## æ€»ç»“

è¿™ä¸ªæ–¹æ¡ˆç¡®ä¿äº†ï¼š
1. âœ… **å®Œå…¨éš”ç¦»**: å®ä¹ ç”Ÿæ— æ³•æ¥è§¦ä¸»ç³»ç»Ÿæ ¸å¿ƒä»£ç 
2. âœ… **æ¥å£ç»Ÿä¸€**: éµå¾ªç›¸åŒçš„APIè§„èŒƒ
3. âœ… **ç‹¬ç«‹å¼€å‘**: æœ‰å®Œæ•´çš„å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
4. âœ… **æ— ç¼é›†æˆ**: å¼€å‘å®Œæˆåå¯ç›´æ¥æ›¿æ¢
5. âœ… **è´¨é‡ä¿è¯**: æœ‰æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†å’Œæµ‹è¯•è¦æ±‚

é€šè¿‡è¿™ä¸ªæ–¹æ¡ˆï¼Œå®ä¹ ç”Ÿå¯ä»¥ä¸“æ³¨äºæ ¸å¿ƒå›æµ‹å¼•æ“çš„å®ç°ï¼Œè€Œä¸éœ€è¦äº†è§£æ•´ä¸ªç³»ç»Ÿçš„å¤æ‚æ¶æ„ï¼ŒåŒæ—¶ä¿è¯äº†ä»£ç è´¨é‡å’Œé›†æˆçš„é¡ºåˆ©è¿›è¡Œã€‚
