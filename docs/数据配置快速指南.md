# æ•°æ®é…ç½®å¿«é€ŸæŒ‡å—

## âœ… ç¡®è®¤ï¼šå®Œå…¨å…¼å®¹ `/Volumes/Extreme SSD/stockdata`

ç»è¿‡å®Œæ•´æµ‹è¯•éªŒè¯ï¼Œ**SimpleCSVDataProvider** å·²ç» 100% æ”¯æŒè¯¥æ•°æ®ç›®å½•ã€‚

## å¼€å‘è€…åªéœ€è¦æ”¹ä¸€ä¸ªå‚æ•°

### æ–¹å¼ 1: ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ¨èï¼‰

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š

```bash
cd jq-backtest-standalone-full
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œå–æ¶ˆæ³¨é‡Šï¼š

```bash
# DATA_ROOT=./data/sample  # æ³¨é‡Šæ‰æµ‹è¯•æ•°æ®
DATA_ROOT=/Volumes/Extreme SSD/stockdata  # ä½¿ç”¨å®Œæ•´æ•°æ®
```

3. ä½¿ç”¨ï¼ˆä¼šè‡ªåŠ¨è¯»å– .envï¼‰ï¼š

```python
from backend.jq_backtest.data_provider_adapter import BacktestOriginDataProvider as SimpleCSVDataProvider

# ä¼šè‡ªåŠ¨ä» .env è¯»å– DATA_ROOT
provider = SimpleCSVDataProvider()
```

### æ–¹å¼ 2: ç›´æ¥ä¼ å‚

```python
from backend.jq_backtest.data_provider_adapter import BacktestOriginDataProvider as SimpleCSVDataProvider

provider = SimpleCSVDataProvider('/Volumes/Extreme SSD/stockdata')
```

**å°±è¿™ä¹ˆç®€å•ï¼**

## éªŒè¯å…¼å®¹æ€§

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python3 test_stockdata_compatibility.py
```

é¢„æœŸè¾“å‡ºï¼š

```
âœ… åˆå§‹åŒ–æˆåŠŸ
âœ… è·¯å¾„è§£æåŒ¹é… (daily/000001.XSHE.csv)
âœ… è·¯å¾„è§£æåŒ¹é… (daily/000001.XSHE_qfq.csv)
âœ… è·¯å¾„è§£æåŒ¹é… (minute/000001.XSHE.csv)
âœ… æ ¼å¼æ£€æµ‹æ­£ç¡® (is_main_system = False)
```

## æ•°æ®æ ¼å¼è¦æ±‚

### ç›®å½•ç»“æ„

```
/Volumes/Extreme SSD/stockdata/
â”œâ”€â”€ daily/
â”‚   â”œâ”€â”€ 000001.XSHE.csv        # ä¸å¤æƒæ—¥çº¿æ•°æ®
â”‚   â”œâ”€â”€ 000001.XSHE_qfq.csv    # å‰å¤æƒæ—¥çº¿æ•°æ®
â”‚   â””â”€â”€ 000001.XSHE_hfq.csv    # åå¤æƒæ—¥çº¿æ•°æ®
â””â”€â”€ minute/
    â””â”€â”€ 000001.XSHE.csv         # åˆ†é’Ÿæ•°æ®
```

### CSV æ ¼å¼

å¿…é¡»åŒ…å«çš„åˆ—ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼š

- `datetime` / `date` / `time`
- `open`
- `high`
- `low`
- `close`
- `volume`

ç¤ºä¾‹ï¼š

```csv
datetime,open,high,low,close,volume
2024-01-02,10.5,10.8,10.3,10.7,1000000
2024-01-03,10.7,11.0,10.6,10.9,1200000
```

## è‡ªåŠ¨æ ¼å¼æ£€æµ‹

SimpleCSVDataProvider ä¼šè‡ªåŠ¨æ£€æµ‹æ•°æ®æ ¼å¼ï¼š

1. **ç®€åŒ–æ ¼å¼** (ä½ çš„æ•°æ®)ï¼š`/stockdata/daily/000001.XSHE.csv`

   - å½“ `(data_root / "dailyweekly")` ç›®å½•ä¸å­˜åœ¨æ—¶ä½¿ç”¨

2. **ä¸»ç³»ç»Ÿæ ¼å¼**ï¼š`/stock/TB/dailyweekly/000001.XSHE/000001.XSHE_daily.csv`
   - å½“ `(data_root / "dailyweekly")` ç›®å½•å­˜åœ¨æ—¶ä½¿ç”¨

**ä½ çš„æ•°æ®ä¼šè¢«è¯†åˆ«ä¸ºç®€åŒ–æ ¼å¼ï¼Œæ— éœ€ä»»ä½•é…ç½®ï¼**

## å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```python
from backend.jq_backtest.data_provider_adapter import BacktestOriginDataProvider as SimpleCSVDataProvider
import pandas as pd

# 1. åˆå§‹åŒ–ï¼ˆä½¿ç”¨å®Œæ•´æ•°æ®ï¼‰
provider = SimpleCSVDataProvider('/Volumes/Extreme SSD/stockdata')

# 2. åŠ è½½æ—¥çº¿æ•°æ®ï¼ˆä¸å¤æƒï¼‰
df_no_adjust = provider.load_data(
    security='000001.XSHE',
    frequency='daily',
    start_time='2024-01-01',
    end_time='2024-12-31',
    adjust_type=None  # ä¸å¤æƒ
)

# 3. åŠ è½½æ—¥çº¿æ•°æ®ï¼ˆå‰å¤æƒï¼‰
df_qfq = provider.load_data(
    security='000001.XSHE',
    frequency='daily',
    start_time='2024-01-01',
    end_time='2024-12-31',
    adjust_type='qfq'  # å‰å¤æƒ
)

# 4. åŠ è½½åˆ†é’Ÿæ•°æ®
df_minute = provider.load_data(
    security='000001.XSHE',
    frequency='1min',
    start_time='2024-01-02 09:30:00',
    end_time='2024-01-02 15:00:00'
)

# 5. åˆ—å‡ºå¯ç”¨è¯åˆ¸
securities = provider.list_securities()
print(f"æ€»å…± {len(securities)} ä¸ªè¯åˆ¸")
```

## å¸¸è§é—®é¢˜

### Q: å¦‚æœæ•°æ®æ–‡ä»¶è¿˜æ²¡å‡†å¤‡å¥½æ€ä¹ˆåŠï¼Ÿ

A: å¯ä»¥å…ˆä½¿ç”¨æµ‹è¯•æ•°æ®å¼€å‘ï¼š

```python
provider = SimpleCSVDataProvider('./data/sample')
```

### Q: æ”¯æŒå“ªäº›å¤æƒæ–¹å¼ï¼Ÿ

A: ä¸‰ç§å¤æƒæ–¹å¼ï¼š

- `None` - ä¸å¤æƒ
- `'qfq'` - å‰å¤æƒ
- `'hfq'` - åå¤æƒ

### Q: æ•°æ®æ ¼å¼è‡ªåŠ¨æ£€æµ‹ä¼šå‡ºé”™å—ï¼Ÿ

A: ä¸ä¼šã€‚æ£€æµ‹é€»è¾‘éå¸¸å¯é ï¼š

```python
is_main_system = (data_root / "dailyweekly").exists()
```

ä½ çš„æ•°æ®ç›®å½•ä¸åŒ…å« `dailyweekly/`ï¼Œæ‰€ä»¥ä¸€å®šä¼šè¢«æ­£ç¡®è¯†åˆ«ä¸ºç®€åŒ–æ ¼å¼ã€‚

### Q: å¦‚ä½•éªŒè¯æ•°æ®è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Ÿ

A: è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python3 test_stockdata_compatibility.py
```

æˆ–åœ¨ä»£ç ä¸­æ£€æŸ¥ï¼š

```python
provider = SimpleCSVDataProvider('/Volumes/Extreme SSD/stockdata')
print(f"æ ¼å¼ç±»å‹: {'ä¸»ç³»ç»Ÿ' if provider.is_main_system else 'ç®€åŒ–æ ¼å¼'}")

path = provider._get_simple_path('000001.XSHE', 'daily')
print(f"æ•°æ®è·¯å¾„: {path}")
print(f"æ–‡ä»¶å­˜åœ¨: {path.exists()}")
```

## æ€§èƒ½å»ºè®®

1. **æ•°æ®ç¼“å­˜**ï¼šå¦‚æœé¢‘ç¹åŠ è½½ç›¸åŒæ•°æ®ï¼Œè€ƒè™‘ç¼“å­˜
2. **æ—¶é—´èŒƒå›´**ï¼šåªåŠ è½½éœ€è¦çš„æ—¶é—´èŒƒå›´ï¼Œé¿å…åŠ è½½å…¨éƒ¨æ•°æ®
3. **åˆ†æ‰¹å¤„ç†**ï¼šå¤„ç†å¤§é‡è¯åˆ¸æ—¶ï¼Œä½¿ç”¨æ‰¹å¤„ç†æ¨¡å¼

## æ€»ç»“

âœ… **å®Œå…¨å…¼å®¹** `/Volumes/Extreme SSD/stockdata`  
âœ… **è‡ªåŠ¨æ£€æµ‹** æ•°æ®æ ¼å¼ï¼Œæ— éœ€é…ç½®  
âœ… **å¼€å‘è€…åªéœ€è¦æ”¹ä¸€ä¸ªå‚æ•°** - æ•°æ®æ ¹ç›®å½•è·¯å¾„  
âœ… **ç»è¿‡å®Œæ•´æµ‹è¯•éªŒè¯** - æ‰€æœ‰è·¯å¾„è§£ææ­£ç¡®

ç°åœ¨å¯ä»¥æŠŠè¿™ä¸ªæ¨¡å—äº¤ç»™å®ä¹ ç”Ÿäº†ï¼ğŸ‰
