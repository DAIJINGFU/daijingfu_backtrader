# 数据配置快速指南

## ✅ 确认：完全兼容 `/Volumes/Extreme SSD/stockdata`

经过完整测试验证，**SimpleCSVDataProvider** 已经 100% 支持该数据目录。

## 开发者只需要改一个参数

### 方式 1: 环境变量配置（推荐）

1. 复制环境变量模板：

```bash
cd jq-backtest-standalone-full
cp .env.example .env
```

2. 编辑 `.env` 文件，取消注释：

```bash
# DATA_ROOT=./data/sample  # 注释掉测试数据
DATA_ROOT=/Volumes/Extreme SSD/stockdata  # 使用完整数据
```

3. 使用（会自动读取 .env）：

```python
from backend.jq_backtest.data_provider_adapter import BacktestOriginDataProvider as SimpleCSVDataProvider

# 会自动从 .env 读取 DATA_ROOT
provider = SimpleCSVDataProvider()
```

### 方式 2: 直接传参

```python
from backend.jq_backtest.data_provider_adapter import BacktestOriginDataProvider as SimpleCSVDataProvider

provider = SimpleCSVDataProvider('/Volumes/Extreme SSD/stockdata')
```

**就这么简单！**

## 验证兼容性

运行测试脚本：

```bash
python3 test_stockdata_compatibility.py
```

预期输出：

```
✅ 初始化成功
✅ 路径解析匹配 (daily/000001.XSHE.csv)
✅ 路径解析匹配 (daily/000001.XSHE_qfq.csv)
✅ 路径解析匹配 (minute/000001.XSHE.csv)
✅ 格式检测正确 (is_main_system = False)
```

## 数据格式要求

### 目录结构

```
/Volumes/Extreme SSD/stockdata/
├── daily/
│   ├── 000001.XSHE.csv        # 不复权日线数据
│   ├── 000001.XSHE_qfq.csv    # 前复权日线数据
│   └── 000001.XSHE_hfq.csv    # 后复权日线数据
└── minute/
    └── 000001.XSHE.csv         # 分钟数据
```

### CSV 格式

必须包含的列（不区分大小写）：

- `datetime` / `date` / `time`
- `open`
- `high`
- `low`
- `close`
- `volume`

示例：

```csv
datetime,open,high,low,close,volume
2024-01-02,10.5,10.8,10.3,10.7,1000000
2024-01-03,10.7,11.0,10.6,10.9,1200000
```

## 自动格式检测

SimpleCSVDataProvider 会自动检测数据格式：

1. **简化格式** (你的数据)：`/stockdata/daily/000001.XSHE.csv`

   - 当 `(data_root / "dailyweekly")` 目录不存在时使用

2. **主系统格式**：`/stock/TB/dailyweekly/000001.XSHE/000001.XSHE_daily.csv`
   - 当 `(data_root / "dailyweekly")` 目录存在时使用

**你的数据会被识别为简化格式，无需任何配置！**

## 完整使用示例

```python
from backend.jq_backtest.data_provider_adapter import BacktestOriginDataProvider as SimpleCSVDataProvider
import pandas as pd

# 1. 初始化（使用完整数据）
provider = SimpleCSVDataProvider('/Volumes/Extreme SSD/stockdata')

# 2. 加载日线数据（不复权）
df_no_adjust = provider.load_data(
    security='000001.XSHE',
    frequency='daily',
    start_time='2024-01-01',
    end_time='2024-12-31',
    adjust_type=None  # 不复权
)

# 3. 加载日线数据（前复权）
df_qfq = provider.load_data(
    security='000001.XSHE',
    frequency='daily',
    start_time='2024-01-01',
    end_time='2024-12-31',
    adjust_type='qfq'  # 前复权
)

# 4. 加载分钟数据
df_minute = provider.load_data(
    security='000001.XSHE',
    frequency='1min',
    start_time='2024-01-02 09:30:00',
    end_time='2024-01-02 15:00:00'
)

# 5. 列出可用证券
securities = provider.list_securities()
print(f"总共 {len(securities)} 个证券")
```

## 常见问题

### Q: 如果数据文件还没准备好怎么办？

A: 可以先使用测试数据开发：

```python
provider = SimpleCSVDataProvider('./data/sample')
```

### Q: 支持哪些复权方式？

A: 三种复权方式：

- `None` - 不复权
- `'qfq'` - 前复权
- `'hfq'` - 后复权

### Q: 数据格式自动检测会出错吗？

A: 不会。检测逻辑非常可靠：

```python
is_main_system = (data_root / "dailyweekly").exists()
```

你的数据目录不包含 `dailyweekly/`，所以一定会被正确识别为简化格式。

### Q: 如何验证数据路径是否正确？

A: 运行测试脚本：

```bash
python3 test_stockdata_compatibility.py
```

或在代码中检查：

```python
provider = SimpleCSVDataProvider('/Volumes/Extreme SSD/stockdata')
print(f"格式类型: {'主系统' if provider.is_main_system else '简化格式'}")

path = provider._get_simple_path('000001.XSHE', 'daily')
print(f"数据路径: {path}")
print(f"文件存在: {path.exists()}")
```

## 性能建议

1. **数据缓存**：如果频繁加载相同数据，考虑缓存
2. **时间范围**：只加载需要的时间范围，避免加载全部数据
3. **分批处理**：处理大量证券时，使用批处理模式

## 总结

✅ **完全兼容** `/Volumes/Extreme SSD/stockdata`  
✅ **自动检测** 数据格式，无需配置  
✅ **开发者只需要改一个参数** - 数据根目录路径  
✅ **经过完整测试验证** - 所有路径解析正确

现在可以把这个模块交给实习生了！🎉
